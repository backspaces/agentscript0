(function(){var AgentsCreateModel,LinksCreateModel,Model,code,t,u,__hasProp={}.hasOwnProperty,__extends=function(e,t){function n(){this.constructor=e}for(var r in t)__hasProp.call(t,r)&&(e[r]=t[r]);return n.prototype=t.prototype,e.prototype=new n,e.__super__=t.prototype,e};"undefined"==typeof window&&(code=require("../lib/agentscript.coffee"),eval("var ABM = this.ABM = code.ABM")),u=ABM.util,ABM.test={},ABM.test.Model=Model=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.setup=function(){return this.preSetup(),this.setupBreeds(),this.setupPatches(),this.setupAgents(),this.setupCitizens(),this.setupLinks()},t.prototype.preSetup=function(){},t.prototype.setupBreeds=function(){return this.agentBreeds(["citizens"])},t.prototype.setupPatches=function(){return this.patches.create()},t.prototype.setupAgents=function(){var e,t,n,r,o,i;for(t=-20,o=this.agents.create(41),i=[],n=0,r=o.length;r>n;n++)e=o[n],e.moveTo({x:t,y:t}),i.push(t+=1);return i},t.prototype.setupCitizens=function(){var e,t,n,r,o,i,u;for(t=10,n=10,i=this.citizens.create(10),u=[],r=0,o=i.length;o>r;r++)e=i[r],e.moveTo({x:t,y:n}),t+=1,t>14?(t=10,u.push(n+=1)):u.push(void 0);return u},t.prototype.setupLinks=function(){var e,t,n,r,o,i,u;for(o=[[0,1],[2,1],[1,2],[1,3],[4,10]],u=[],n=0,r=o.length;r>n;n++)i=o[n],e=i[0],t=i[1],u.push(this.links.create(this.agents[e],this.agents[t]));return u},t}(ABM.Model),ABM.test.setupModel=function(e){var t;return null==e&&(e={}),null==e.torus&&(e.torus=!1),null==e.model&&(e.model=Model),t=new e.model({patchSize:20,mapSize:40,isTorus:e.torus,hasNeighbors:!0})},"undefined"==typeof window&&(t=require("./shared.coffee"),eval("var ABM = t.ABM")),t=ABM.test,u=ABM.util,describe("Agent",function(){return describe("toString",function(){return it("gives the string representation of an agent",function(){var e,n;return n=t.setupModel(),e=n.agents[0],e.heading=2.25,e.color=u.colorFromString("red"),expect(e.toString()).toEqual("{id: 0, position: {x: -20.00, y: -20.00}, c: 255,0,0, h: 2.25}")})}),describe("moveTo",function(){return it("moves to the given location",function(){var e,n,r,o,i;return n=t.setupModel(),e=n.agents[0],r=e.patch,o=r.agents.length,e.moveTo({x:17,y:15}),i=n.patches.patch({x:17,y:15}),expect(e.position).toEqual({x:17,y:15}),expect(e.patch).toBe(i),expect(i.agents[0]).toBe(e),expect(r.agents.length).toBe(o-1),e.moveTo({x:11,y:12}),i=n.patches.patch({x:11,y:12}),expect(e.position).toEqual({x:11,y:12}),expect(i.agents[0]).toBe(e),e.moveTo({x:8.5,y:7.4}),i=n.patches.patch({x:9,y:7}),expect(e.position).toEqual({x:8.5,y:7.4}),expect(i.agents[0]).toBe(e)})}),describe("moveOff",function(){return it("moves the agent off the grid",function(){var e,n;return n=t.setupModel(),e=n.agents[0],e.moveOff(),expect(e.patch).toBe(null),expect(e.position).toBe(null)})}),describe("forward",function(){return it("moves the agent forward",function(){var e,n;return n=t.setupModel(),e=n.agents,e[0].face(e[1].position),e[0].forward(Math.sqrt(2)),expect(e[0].position.x).toBeCloseTo(e[1].position.x),expect(e[0].position.y).toBeCloseTo(e[1].position.y),expect(e[0].patch).toBe(e[1].patch)})}),describe("rotate",function(){return it("rotates the agent",function(){var e,n,r,o;return r=t.setupModel(),e=r.agents[0],e.heading=o=1.5,n=2.1,e.rotate(n),expect(e.heading).toBeCloseTo(o+n)})}),describe("face",function(){return it("makes the agent face the given point",function(){var e,n;return n=t.setupModel(),e=n.agents[0],e.face({x:0,y:0}),expect(e.heading).toBeCloseTo(u.degreesToRadians(45))})}),describe("distance",function(){return it("returns the distance to the given point",function(){var e,n;return n=t.setupModel(),e=n.agents,expect(e[0].distance(e[1].position)).toBeCloseTo(Math.sqrt(2))})}),describe("neighbors",function(){return it("returns the neighbors in euclidian space",function(){var e,n;return e=t.setupModel().agents,n=e[20].neighbors(3),expect(n.length).toBe(6),n=e[40].neighbors(2),expect(n.length).toBe(2)}),it("returns no neighbors if there are none",function(){var e,n;return e=t.setupModel().agents[20],e.moveTo({x:-10,y:10}),n=e.neighbors(),expect(n.length).toBe(0)}),it("returns the diamond neighbors",function(){var e,n;return e=t.setupModel().agents,n=e[20].neighbors({diamond:2}),expect(n.length).toBe(2),n=e[20].neighbors({diamond:3}),expect(n.length).toBe(2),n=e[20].neighbors({diamond:4}),expect(n.length).toBe(4)}),it("returns the neighbors requested if the world is a torus",function(){var e,n;return e=t.setupModel({torus:!0}).agents,n=e[40].neighbors(2),expect(n.length).toBe(4),expect(n[0]).toBe(e[38]),expect(n[1]).toBe(e[39]),expect(n[2]).toBe(e[0]),expect(n[3]).toBe(e[1])}),it("returns the diamond neighbors if the world is a torus",function(){var e,n,r;return n=t.setupModel({torus:!0}),e=t.setupModel({torus:!0}).agents,r=e[40].neighbors({diamond:3}),expect(r.length).toBe(2),expect(r[0]).toBe(e[39]),expect(r[1]).toBe(e[0])}),it("returns the radius neighbors",function(){var e,n;return e=t.setupModel().agents,n=e[20].neighbors({radius:3}),expect(n.length).toBe(4),e[0].moveTo({x:0,y:3}),e[1].moveTo({x:0,y:-3}),n=e[20].neighbors({radius:3}),expect(n.length).toBe(6),e[20].moveTo({x:0,y:.1}),n=e[20].neighbors({radius:3}),expect(n.length).toBe(5),e[3].moveTo({x:0,y:3.1}),n=e[20].neighbors({radius:3}),expect(n.length).toBe(6)}),it("returns the cone neighbors",function(){var e,n;return e=t.setupModel().agents,e[20].heading=0,n=e[20].neighbors({cone:u.degreesToRadians(180),radius:3}),expect(n.length).toBe(2),n=e[20].neighbors({cone:u.degreesToRadians(360),radius:3}),expect(n.length).toBe(4),e[0].moveTo({x:0,y:2}),n=e[20].neighbors({cone:u.degreesToRadians(180),radius:3}),expect(n.length).toBe(3),n=e[20].neighbors({cone:u.degreesToRadians(90),radius:3}),expect(n.length).toBe(2)})}),describe("die",function(){return it("dies, is removed from patch and breed list",function(){var e,n,r,o;return r=t.setupModel(),e=r.agents[0],n=e.id,o=e.patch,e.die(),expect(o.agents.length).toBe(0),expect(r.agents[0].id).not.toBe(n)})}),describe("hatch",function(){return it("creates num new agents at this location",function(){var e,n,r;return r=t.setupModel(),e=r.agents[0],e.custo=1337,e.hatch(2),n=e.patch.agents,expect(n.length).toBe(3),expect(n[1].custom).toBe(e.custom),expect(n[2].custom).toBe(e.custom)})}),describe("otherEnd",function(){return it("returns the other end of a link",function(){var e,n;return n=t.setupModel(),e=n.agents,n.links.create(e[0],e[1]),expect(e[0].otherEnd(n.links[0])).toBe(e[1])})}),describe("inLinks",function(){return it("returns the incoming links",function(){var e,n,r;return r=t.setupModel(),e=r.agents,n=e[1].inLinks(),expect(n.length).toBe(2),expect(n[0]).toBe(r.links[0]),expect(n[1]).toBe(r.links[1])})}),describe("outLinks",function(){return it("returns the outgoing links",function(){var e,n,r;return r=t.setupModel(),e=r.agents,n=e[1].outLinks(),expect(n.length).toBe(2),expect(n[0]).toBe(r.links[2]),expect(n[1]).toBe(r.links[3])})}),describe("linkNeighbors",function(){return it("returns all agents linked with",function(){var e,n,r;return r=t.setupModel(),e=r.agents,n=e[1].linkNeighbors(),expect(n.length).toBe(3),expect(n[0]).toBe(e[0]),expect(n[1]).toBe(e[2]),expect(n[2]).toBe(e[3])})}),describe("inLinkNeighbors",function(){return it("returns all agents that link to this one",function(){var e,n,r;return r=t.setupModel(),e=r.agents,n=e[1].inLinkNeighbors(),expect(n.length).toBe(2),expect(n[0]).toBe(e[0]),expect(n[1]).toBe(e[2])})}),describe("outLinkNeighbors",function(){return it("returns all agents that link to this one",function(){var e,n,r;return r=t.setupModel(),e=r.agents,n=e[1].outLinkNeighbors(),expect(n.length).toBe(2),expect(n[0]).toBe(e[2]),expect(n[1]).toBe(e[3])})})}),"undefined"==typeof window&&(t=require("./shared.coffee"),eval("var ABM = t.ABM")),t=ABM.test,u=ABM.util,AgentsCreateModel=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.setup=function(){return this.setupPatches(),this.counter=0,this.agents.create(2,function(e){return function(){return e.counter+=1}}(this))},t}(t.Model),describe("Agents",function(){return describe("in",function(){return it("returns all instances of the default breed",function(){var e,n;return n=t.setupModel(),e=n.agents["in"](n.agents),expect(e.length).toBe(n.agents.length-n.citizens.length),expect(e.first).toBe(n.agents.first)}),it("returns all instances of the given breed",function(){var e,n,r,o;return n=t.setupModel(),r=n.agents["in"](n.citizens),expect(r.length).toBe(0),e=n.citizens["in"](n.citizens),expect(e.length).toBe(n.citizens.length),expect(e.first).toBe(n.citizens.first),o=n.citizens["in"](n.agents),expect(o.length).toBe(n.citizens.length)})}),describe("create",function(){return it("creates the agents",function(){var e;return e=t.setupModel({model:AgentsCreateModel}),expect(e.counter).toBe(e.agents.length)}),it("creates the agents for breeds",function(){var e;return e=t.setupModel(),expect(e.agents.length).toBe(51),expect(e.citizens.length).toBe(10),expect(e.citizens.last().breed).toBe(e.citizens)})}),describe("clear",function(){return it("clears agents",function(){var e;return e=t.setupModel(),e.citizens.clear(),expect(e.citizens.length).toBe(0),expect(e.agents.length).not.toBe(0)})}),describe("neighboring",function(){return it("returns agents of same breed that are neighbors",function(){var e,n;return e=t.setupModel(),n=e.citizens.neighboring(e.citizens[2],1),expect(n.length).toBe(5),n=e.citizens.neighboring(e.citizens[0],8),expect(n.length).toBe(9)})}),describe("formCircle",function(){return it("positions the agents in a circle",function(){var e;return e=t.setupModel(),e.agents.formCircle(10),expect(e.agents[0].position.x).toBeCloseTo(0),expect(e.agents[0].position.y).toBeCloseTo(10),expect(e.agents[10].position.x).toBeCloseTo(9.43),expect(e.agents[10].position.y).toBeCloseTo(3.32),expect(e.agents[41].position.x).toBeCloseTo(-9.43),expect(e.agents[41].position.y).toBeCloseTo(3.32)})})}),"undefined"==typeof window&&(t=require("./shared.coffee"),eval("var ABM = t.ABM")),t=ABM.test,u=ABM.util,describe("Array",function(){return describe("from",function(){return it("turns array into an ABM.Array",function(){var e;return e=ABM.Array.from([3,2,1]),expect(e.length).toBe(3),expect(typeof e.histogram).toBe("function"),expect(e.constructor.name).toBe("Array"),expect(e).toEqual(new ABM.Array(3,2,1))}),it("also works on an ABM.Array",function(){var e,t;return t=ABM.Array.from([3,2,1]),e=ABM.Array.from(t),expect(e.length).toBe(3),expect(typeof e.histogram).toBe("function"),expect(e.constructor.name).toBe("Array"),expect(e).toEqual(new ABM.Array(3,2,1))})}),describe("constructor",function(){return it("Creates the array",function(){var e;return e=new ABM.Array(1,2,3),expect(e.length).toBe(3),expect(e.constructor.name).toBe("Array"),e=new ABM.Array([1,4]),expect(e.length).toBe(1)}),it("Creates empty arrays correctly",function(){var e;return e=new ABM.Array,expect(e.length).toBe(0),expect(e.constructor.name).toBe("Array"),e.push(2),expect(e.length).toBe(1),expect(e.constructor.name).toBe("Array"),expect(e).toEqual(new ABM.Array(2))})}),describe("toFixed",function(){return it("returns the array rounded, as strings",function(){return expect(new ABM.Array(1.334,5.445,11.666).toFixed(1)).toEqual(new ABM.Array("1.3","5.4","11.7"))})}),describe("any",function(){return it("returns false if empty",function(){return expect((new ABM.Array).any()).toBe(!1)})}),describe("empty",function(){return it("returns true if empty",function(){return expect((new ABM.Array).empty()).toBe(!0),expect(new ABM.Array(1,2).empty()).toBe(!1)})}),describe("clone",function(){return it("returns a copy of the array",function(){var e,t;return e=new ABM.Array(1,2,3),t=e.clone(),expect(e).toEqual(ABM.Array.from(t)),t[1]=7,expect(e[1]).not.toEqual(t[1])})}),describe("last",function(){return it("returns the last element",function(){return expect(new ABM.Array(1,2,3).last()).toEqual(3)})}),describe("sample",function(){return it("returns one object if no number given",function(){var e;return u.randomSeed(2),e=new ABM.Array(1,2,3,4).sample(),expect(e).toEqual(4)}),it("returns the number of objects if number given",function(){var e;return u.randomSeed(2),e=new ABM.Array(1,2,3,4).sample(2),expect(e).toEqual(new ABM.Array(4,1))}),it("returns sample for which true if condition given",function(){var e;return u.randomSeed(10),e=new ABM.Array(1,2,3,4,5,6).sample(function(e){return e%2===0}),expect(e).toEqual(2)}),it("returns sample for which true if condition and number is given",function(){var e;return u.randomSeed(2),e=new ABM.Array(1,2,3,4,5,6).sample(2,function(e){return e%2===0}),expect(e).toEqual(new ABM.Array(6,2))})}),describe("contains",function(){return it("returns true if it contains the element",function(){return expect(new ABM.Array(1,2,3).contains(2)).toBe(!0),expect(new ABM.Array(1,2,3).contains(5)).toBe(!1)})}),describe("remove",function(){return it("removes the item",function(){var e;return expect(new ABM.Array(1,2,3).remove(2)).toEqual(new ABM.Array(1,3)),e=new ABM.Array(1,"z",7,7),e.remove(7),expect(e).toEqual(new ABM.Array(1,"z"))})}),describe("removeItems",function(){return it("removes the items",function(){return expect(new ABM.Array(1,2,3,4,5).removeItems([2,4])).toEqual(new ABM.Array(1,3,5))})}),describe("shuffle",function(){return it("shuffles the array",function(){return u.randomSeed(2),expect(new ABM.Array(1,2,3).shuffle()).toEqual(new ABM.Array(1,3,2))})}),describe("min",function(){return it("returns the smallest element",function(){return expect(new ABM.Array(7,3,2,3).min()).toEqual(2)})}),describe("max",function(){return it("returns the biggest element",function(){return expect(new ABM.Array(7,3,2,3).max()).toEqual(7)})}),describe("sum",function(){return it("returns the sum",function(){return expect(new ABM.Array(7,3,2,3).sum()).toEqual(15)})}),describe("average",function(){return it("returns the average",function(){return expect(new ABM.Array(7,3,2,3).average()).toEqual(3.75)})}),describe("median",function(){return it("returns the median",function(){return expect(new ABM.Array(7,3,2).median()).toEqual(3),expect(new ABM.Array(7,3,2,4).median()).toEqual(3.5)})}),describe("histogram",function(){return it("returns the histogram",function(){return expect(new ABM.Array(0,2,6,8,2).histogram(3)).toEqual(new ABM.Array(3,0,2))})}),describe("sort",function(){return it("sorts the array",function(){var e;return e=new ABM.Array(2.4,8,2),e.sort(function(e,t){return Math.floor(e)>Math.floor(t)}),expect(e).toEqual(new ABM.Array(2.4,2,8))})}),describe("uniq",function(){return it("returns the array with only unique items",function(){var e;return e=new ABM.Array(0,2,1,0,8,2,1,1),e.uniq(),expect(e).toEqual(new ABM.Array(0,2,1,8))})}),describe("flatten",function(){return it("flattens the matrix to an array",function(){return expect(new ABM.Array([7],[3,2],[3]).flatten()).toEqual(new ABM.Array(7,3,2,3)),expect(new ABM.Array([3,2],[5,7,9],[3,66]).flatten()).toEqual(new ABM.Array(3,2,5,7,9,3,66))})}),describe("normalize",function(){return it("returns the array normalized",function(){return expect(new ABM.Array(4,9,7).normalize(5,10)).toEqual(new ABM.Array(5,10,8))})})}),"undefined"==typeof window&&(t=require("./shared.coffee"),eval("var ABM = t.ABM")),t=ABM.test,u=ABM.util,describe("Set",function(){return describe("constructor",function(){return it("Creates the set",function(){var e;return e=new ABM.BreedSet(ABM.Agent,"agents"),expect(e.length).toBe(0),expect(e.name).toBe("agents"),expect(e.agentClass).toBe(ABM.Agent),expect(e.mainSet).toBe(void 0),expect(e.breeds).toEqual([]),expect(e.ID).toBe(0)}),it("Creates a subset",function(){var e,n;return e=t.setupModel(),n=new ABM.BreedSet(e.Agent,"ducks",e.Agent.prototype.breed),expect(n.length).toBe(0),expect(n.mainSet.name).toBe("agents"),expect(n.mainSet.length).toEqual(e.agents.length),expect(n.breeds).toBe(void 0),expect(n.ID).toBe(void 0),expect(e.agents.breeds.length).toBe(1),expect(e.agents.breeds[0].name).toBe("citizens")})}),describe("push",function(){return it("Adds to main set",function(){var e,n,r;return e=t.setupModel(),n=e.agents.ID,r={},e.agents.push(r),expect(r.id).toBe(n),expect(e.agents.last()).toBe(r),expect(e.citizens.last()).not.toBe(r)}),it("Adds to sub- (& main) set",function(){var e,n,r;return e=t.setupModel(),n=e.agents.ID,r={},e.citizens.push(r),expect(r.id).toBe(n),expect(e.citizens.last()).toBe(r),expect(e.agents.last()).toBe(r)})}),describe("remove",function(){return it("Removes from both sets",function(){var e,n;return n=t.setupModel(),e=n.citizens.first(),n.citizens.remove(e),expect(n.agents.contains(e)).not.toBe(!0),expect(n.citizens.contains(e)).not.toBe(!0)})}),describe("pop",function(){return it("Removes last object",function(){var e,n,r;return n=t.setupModel(),e=n.agents.last(),r=n.citizens.pop(),expect(r).toBe(e),expect(n.agents.contains(e)).not.toBe(!0)})}),describe("setBreed",function(){return it("Sets the breed",function(){var e,n,r,o,i;return i=t.setupModel(),e=i.agents.first(),r=i.citizens.first(),n=e.id,o=r.id,i.citizens.setBreed(e),expect(e.breed.name).toBe("citizens"),expect(e.id).toBe(n),i.agents.setBreed(r),expect(r.breed.name).toBe("agents"),expect(r.id).toBe(o)}),it("Sets the breed, copying the prototype if classes differ",function(){})})}),"undefined"==typeof window&&(t=require("./shared.coffee"),eval("var ABM = t.ABM")),t=ABM.test,u=ABM.util,describe("Link",function(){return describe("die",function(){return it("removes the link",function(){var e,n,r,o,i;return o=t.setupModel(),n=o.links.length,r=o.links[0],e=r.from,i=r.to,r.die(),expect(o.links.length).toEqual(n-1),expect(e.links.length).toEqual(0),expect(i.links.length).toEqual(3)})}),describe("bothEnds",function(){return it("returns both ends",function(){var e,n,r;return r=t.setupModel(),n=r.links[0],e=n.bothEnds(),expect(e.length).toEqual(2),expect(e[0].id).toBe(n.from.id),expect(e[1].id).toBe(n.to.id)})}),describe("length",function(){return it("returns the length between both ends",function(){var e,n,r;return r=t.setupModel(),e=r.links[0],expect(e.length()).toBeCloseTo(1.41),n=r.links[4],expect(n.length()).toBeCloseTo(8.49)})}),describe("otherEnd",function(){return it("returns the other end",function(){var e,n;return n=t.setupModel(),e=n.links[1],expect(e.otherEnd(e.from)).toBe(e.to),expect(e.otherEnd(e.to)).toBe(e.from)})})}),"undefined"==typeof window&&(t=require("./shared.coffee"),eval("var ABM = t.ABM")),t=ABM.test,u=ABM.util,LinksCreateModel=function(e){function t(){return t.__super__.constructor.apply(this,arguments)}return __extends(t,e),t.prototype.setup=function(){var e,t,n,r,o,i,u;for(this.setupPatches(),this.setupAgents(),this.counter=0,o=[[0,1],[1,2]],u=[],n=0,r=o.length;r>n;n++)i=o[n],e=i[0],t=i[1],u.push(this.links.create(this.agents[e],this.agents[t],function(e){return function(){return e.counter+=1}}(this)));return u},t}(t.Model),describe("Links",function(){return describe("create",function(){return it("creates the link",function(){var e,n;return n=t.setupModel({model:LinksCreateModel}),e=n.links[0],expect(e.from).toBe(n.agents[0]),expect(e.to).toBe(n.agents[1]),expect(n.counter).toBe(2)})}),describe("clear",function(){return it("clears the list",function(){var e,n,r;return n=t.setupModel(),e=n.links[2],r=e.to,n.links.clear(),expect(n.links.length).toBe(0),expect(r.links.length).toBe(0)})}),describe("nodesWithDups",function(){return it("all nodes, including duplicates",function(){var e,n,r;return n=t.setupModel(),e=n.agents,r=n.links.nodesWithDups(),expect(r.length).toBe(10),expect(r[5]).toBe(e[2])})}),describe("nodes",function(){return it("all nodes, without duplicates",function(){var e,n,r;return n=t.setupModel(),e=n.agents,r=n.links.nodes(),expect(r.length).toBe(6),expect(r[5]).toBe(e[10])})})}),"undefined"==typeof window&&(t=require("./shared.coffee"),eval("var ABM = t.ABM")),t=ABM.test,u=ABM.util,describe("Model",function(){return describe("asSomet",function(){return it("Turns the array into a set",function(){return expect(2).toBe(2)})})}),"undefined"==typeof window&&(t=require("./shared.coffee"),eval("var ABM = t.ABM")),t=ABM.test,u=ABM.util,describe("Patch",function(){return describe("patch",function(){return it("gets the patch",function(){var e,n;return e=t.setupModel(),n=e.patches.patch({x:-20,y:20}),expect(n).toBe(e.patches[0])})}),describe("neighbors",function(){var e,n;return e=function(e){var t,n,r;return r=e.patches.patch({x:10,y:10}),n=r.neighbors(),expect(n.length).toBe(8),expect(n[0].position).toEqual({x:9,y:9}),expect(n[7].position).toEqual({x:11,y:11}),n=r.neighbors(1),expect(n.length).toBe(8),n=r.neighbors(2),expect(n.length).toBe(24),expect(n[0].position).toEqual({x:8,y:8}),expect(n[23].position).toEqual({x:12,y:12}),t=e.patches.patch({x:1,y:1}),n=t.neighbors(),expect(n.length).toBe(8),expect(n[0].position).toEqual({x:0,y:0}),expect(n[1].position).toEqual({x:1,y:0}),expect(n[2].position).toEqual({x:2,y:0})},n=function(e){var t,n;return n=e.patches.patch({x:10,y:10}),t=n.neighbors({diamond:1}),expect(t.length).toBe(4),expect(t[0].position).toEqual({x:10,y:9}),expect(t[3].position).toEqual({x:10,y:11}),t=n.neighbors({diamond:4}),expect(t.length).toBe(40),expect(t[0].position).toEqual({x:10,y:6}),expect(t[1].position).toEqual({x:9,y:7}),expect(t[39].position).toEqual({x:10,y:14}),t=n.neighbors({diamond:4}),expect(t.length).toBe(40)},it("returns the neighbors requested if the world is euclidian",function(){var n;return n=t.setupModel(),e(n)}),it("returns the diamond neighbors if the world is euclidian",function(){var e,r,o,i;return r=t.setupModel(),n(r),e=r.patches.patch({x:17,y:17}),o=e.neighbors({diamond:7}),expect(o.length).toBe(80),expect(o[0].position).toEqual({x:17,y:10}),expect(o[79].position).toEqual({x:20,y:20}),i=r.patches.patch({x:-18,y:-18}),o=i.neighbors({diamond:7}),expect(o.length).toBe(65),expect(o[0].position).toEqual({x:-20,y:-20}),expect(o[1].position).toEqual({x:-19,y:-20}),expect(o[64].position).toEqual({x:-18,y:-11})}),it("returns the neighbors requested if the world is a torus",function(){var n;return n=t.setupModel({torus:!0}),e(n)}),it("returns the diamond neighbors if the world is a torus",function(){var e,r,o,i;return r=t.setupModel({torus:!0}),n(r),e=r.patches.patch({x:17,y:17}),o=e.neighbors({diamond:7}),expect(o.length).toBe(112),expect(o[0].position).toEqual({x:17,y:10}),expect(o[111].position).toEqual({x:17,y:-17}),i=r.patches.patch({x:-18,y:-18}),o=i.neighbors({diamond:7}),expect(o.length).toBe(112),expect(o[0].position).toEqual({x:-18,y:16}),expect(o[1].position).toEqual({x:-19,y:17}),expect(o[54].position).toEqual({x:-20,y:-18})}),it("caches correcly",function(){var e,n,r;return e=t.setupModel(),r=e.patches.patch({x:10,y:10}),n=r.neighbors({range:1,cache:!1}),expect(r.neighborsCache).toEqual({}),n=r.neighbors({range:1}),expect(r.neighborsCache['{"range":1}'].length).toBe(8)})})}),"undefined"==typeof window&&(t=require("./shared.coffee"),eval("var ABM = t.ABM")),t=ABM.test,u=ABM.util,describe("Patches",function(){return describe("patchIndex",function(){return it("returns the index for the patch",function(){var e,n;return n=t.setupModel(),e=n.patches.patchIndex({x:0,y:0}),expect(e).toBe(840)})}),describe("patch",function(){return it("returns the patch at the coordinate",function(){var e,n;return e=t.setupModel(),n=e.patches.patch({x:0,y:.1}),expect(n.position).toEqual({x:0,y:0})})}),describe("coordinate",function(){return it("returns the position as a coordinate",function(){var e,n;return n=t.setupModel(),e=n.patches.coordinate({x:17,y:15}),expect(e).toEqual({x:17,y:15}),e=n.patches.coordinate({x:37,y:15}),expect(e).toEqual({x:20.5,y:15})}),it("returns the position as a coordinate also for torus",function(){var e,n;return n=t.setupModel({torus:!0}),e=n.patches.coordinate({x:50,y:25}),expect(e).toEqual({x:9,y:-16})})})}),"undefined"==typeof window&&(t=require("./shared.coffee"),eval("var ABM = t.ABM")),t=ABM.test,u=ABM.util,describe("Set",function(){return describe("constructor",function(){return it("Creates a new ABM.Set",function(){var e;return e=new ABM.Set(1,2),expect(e.length).toBe(2),expect(typeof e.setDefault).toBe("function"),expect(e.constructor.name).toBe("Set")})}),describe("from",function(){return it("Turns the array into an ABM.Set",function(){var e;return e=ABM.Set.from([1,2]),expect(e.length).toBe(2),expect(typeof e.setDefault).toBe("function"),expect(e.constructor.name).toBe("Set")})}),describe("setDefault",function(){return it("Sets the default",function(){var e;return e=t.setupModel(),e.agents.setDefault("size",17),expect(e.Agent.prototype.size).toBe(17)}),it("The default gets propagated",function(){var e;return t.Model.prototype.preSetup=function(){return this.agents.setDefault("shape","square")},e=t.setupModel(),expect(e.Agent.prototype.shape).toBe("square"),expect(e.agents[0].shape).toBe("square"),expect(e.citizens[0].shape).toBe("square")})}),describe("flatten",function(){return it("Flattens the set, also with subsets",function(){var e,t;return e=new ABM.Set(1,3,9),t=e.flatten(),expect(t.constructor.name).toBe("Set"),expect(t).toEqual(new ABM.Set(1,3,9)),e=new ABM.Set(1,[3,5,7],9),expect(e.flatten()).toEqual(new ABM.Set(1,3,5,7,9)),e=new ABM.Set([1,2,13],[3,5,7],[9,10,11]),expect(e.flatten()).toEqual(new ABM.Set(1,2,13,3,5,7,9,10,11)),e=new ABM.Set(new ABM.Set(1,2,13),new ABM.Set(3,5,7)),expect(e.flatten()).toEqual(new ABM.Set(1,2,13,3,5,7))}),it("Also works with agents/patches in the set",function(){var e,n,r;return e=t.setupModel(),n=e.patches,r=new ABM.Set(new ABM.Set(n[3],n[1],n[4]),new ABM.Set(n[2],n[8],n[9])),expect(r.flatten()).toEqual(new ABM.Set(n[3],n[1],n[4],n[2],n[8],n[9]))})})}),"undefined"==typeof window&&(t=require("./shared.coffee"),eval("var ABM = t.ABM")),t=ABM.test,u=ABM.util,describe("Util",function(){return"undefined"!=typeof window&&eval("global = window"),describe("error",function(){return it("throws an error",function(){return expect(u.error,"Something").toThrow()})}),describe("isArray",function(){return it("detects arrays, and subclasses of array as arrays",function(){var e,t,n,r,o;for(t=[[],ABM.Agents.from([]),[1,2,3],["some",4],new ABM.Array(1,2),new ABM.Set(5,2,99),new ABM.Set,ABM.Set.from([5,2,99]),new ABM.BreedSet(ABM.Agent,"agents")],o=[],n=0,r=t.length;r>n;n++)e=t[n],o.push(expect(u.isArray(e)).toBe(!0));return o}),it("excluded non-arrays",function(){var e,t,n,r,o;for(t=[1,{a:2},function(){return 1}],o=[],n=0,r=t.length;r>n;n++)e=t[n],o.push(expect(u.isArray(e)).toBe(!1));return o})}),describe("isFunction",function(){return it("detects functions",function(){return expect(u.isFunction(function(){return function(){return 2}}(this))).toBe(!0)}),it("rejects non-functions",function(){return expect(u.isFunction(2)).toBe(!1)})}),describe("isString",function(){return it("detects strings",function(){return expect(u.isString("Big dog 2")).toBe(!0)}),it("rejects non-strings",function(){return expect(u.isString(function(){return 3})).toBe(!1)})}),describe("isNumber",function(){return it("detects numbers",function(){return expect(u.isNumber(2)).toBe(!0)}),it("rejects non-numbers",function(){return expect(u.isString(function(){return 3})).toBe(!1)})}),describe("randomSeed",function(){return it("replaces random",function(){return u.randomSeed(2),expect(Math.random()).toBeCloseTo(.97),expect(Math.random()).toBeCloseTo(.2),u.randomSeed(3),expect(Math.random()).toBeCloseTo(.2)})}),describe("randomInt",function(){return it("returns a random int",function(){var e,t,n,r,o;for(u.randomSeed(2),r=[1,0,1],o=[],t=0,n=r.length;n>t;t++)e=r[t],o.push(expect(u.randomInt()).toEqual(e));return o}),it("returns a random int with max value",function(){return u.randomSeed(2),expect(u.randomInt(10)).toEqual(9)}),it("returns a random int between values",function(){return expect(u.randomInt(15,30)).toEqual(18)})}),describe("randomFloat",function(){return it("returns a random float",function(){var e,t,n,r,o;for(u.randomSeed(2),r=[.97,.2,.98],o=[],t=0,n=r.length;n>t;t++)e=r[t],o.push(expect(u.randomFloat()).toBeCloseTo(e));return o})}),describe("randomNormal",function(){return it("returns numbers out of a normal distribution",function(){var e,t,n,r,o;for(u.randomSeed(2),r=[20.87,3.09,32.15,13.15,36.01,-9.53],o=[],t=0,n=r.length;n>t;t++)e=r[t],o.push(expect(u.randomNormal(0,25)).toBeCloseTo(e));return o})}),describe("randomCentered",function(){return it("returns numbers centered ahead in rads",function(){var e,t,n,r,o;for(u.randomSeed(2),r=[.95,-.6],o=[],t=0,n=r.length;n>t;t++)e=r[t],o.push(expect(u.randomCentered(2)).toBeCloseTo(e));return o})}),describe("onceEvery",function(){return it("returns true once every number",function(){var e,t,n,r,o;for(u.randomSeed(2),r=[!0,!1],o=[],t=0,n=r.length;n>t;t++)e=r[t],o.push(expect(u.onceEvery(2)).toBe(e));return o})}),describe("log10",function(){return it("returns log base 10",function(){return expect(u.log10(30)).toBeCloseTo(1.48)})}),describe("log2",function(){return it("returns log base 2",function(){return expect(u.log2(8)).toEqual(3)})}),describe("logN",function(){return it("returns log base X",function(){return expect(u.logN(256,4)).toEqual(4)})}),describe("mod",function(){return it("returns the correct modulo",function(){return expect(u.mod(-5,4)).toEqual(3)})}),describe("wrap",function(){return it("returns number wrapped between min and max",function(){return expect(u.wrap(7,10,20)).toEqual(17)})}),describe("clamp",function(){return it("returns number clamped between min and max",function(){return expect(u.clamp(7,10,20)).toEqual(10),expect(u.clamp(13,10,20)).toEqual(13)})}),describe("sign",function(){return it("returns the sign of the number",function(){return expect(u.sign(-30)).toEqual(-1)})}),describe("colorFromString",function(){return it("returns the color as an array",function(){return expect(u.colorFromString("green")).toEqual([0,128,0])}),it("throws an error if not supported",function(){return expect(u.colorFromString,"ultrasonicviolet").toThrow()})}),describe("fractionOfColor",function(){return it("reduces the color towards white with fraction",function(){return expect(u.fractionOfColor([128,0,32],.5)).toEqual([64,0,16])})}),describe("brightenColor",function(){return it("brightens the color by fraction",function(){return expect(u.brightenColor([0,255,128],.1)).toEqual([26,255,154])})}),describe("colorString",function(){return it("returns the color as a string",function(){return expect(u.colorString([0,255,128])).toEqual("rgb(0,255,128)"),expect(u.colorString([11,25,12,.4])).toEqual("rgba(11,25,12,0.4)")})}),describe("colorsEqual",function(){return it("returns true if the colors are equal",function(){return expect(u.colorsEqual([0,255,128],[0,255,128])).toBe(!0),expect(u.colorsEqual([0,255,128],[1,255,128])).toBe(!1)})}),describe("isLittleEndian",function(){return it("returns true on littleEndian systems",function(){return expect(u.isLittleEndian()).toBe(!0)})}),describe("degreesToRadians",function(){return it("returns the radians",function(){return expect(u.degreesToRadians(90)).toBeCloseTo(1.57)})}),describe("radiansToDegrees",function(){return it("returns the degrees",function(){return expect(u.radiansToDegrees(1)).toBeCloseTo(57.3)})}),describe("substractRadians",function(){return it("returns the angle, between PI and minus PI",function(){return expect(u.substractRadians(1,8)).toBeCloseTo(-.72)})}),describe("ownKeys",function(){return it("returns the attributes",function(){var e;return e=new Object,e.bull="pen",e.fly=function(){return 2},expect(u.ownKeys(e)).toEqual(new ABM.Array("bull","fly"))})}),describe("ownVariableKeys",function(){return it("returns the attributes that are not functions",function(){var e;return e=new Object,e.bull="pen",e.fly=function(){return 2},expect(u.ownVariableKeys(e)).toEqual(new ABM.Array("bull"))})}),describe("ownValues",function(){return it("returns the values",function(){var e;return e=new Object,e.bull="pen",e.fly=function(){return 2},expect(u.ownValues(e)).toEqual(new ABM.Array("pen",e.fly))
})}),describe("angle",function(){return it("returns the radians toward the second point",function(){return expect(u.angle({x:1,y:1},{x:3,y:3},{isTorus:!1})).toBeCloseTo(.79)}),it("returns the radians toward the second point on a torus",function(){return expect(u.angle({x:1,y:1},{x:3,y:3},{isTorus:!0,width:10,height:10})).toBeCloseTo(.79),expect(u.angle({x:1,y:1},{x:3,y:3},{isTorus:!0,width:3,height:3})).toBeCloseTo(-2.36)})}),describe("inCone",function(){return it("returns true if in cone",function(){return expect(u.inCone(3,6,3,{x:1,y:1},{x:2,y:2},{isTorus:!1})).toBe(!0),expect(u.inCone(3,3,1,{x:1,y:1},{x:2,y:2},{isTorus:!1})).toBe(!1)}),it("returns true if in cone for toruses too",function(){return expect(u.inCone(3,6,3,{x:1,y:1},{x:2,y:2},{isTorus:!0,width:10,height:10})).toBe(!0),expect(u.inCone(3,3,3,{x:1,y:1},{x:2,y:2},{isTorus:!0,width:10,height:10})).toBe(!1),expect(u.inCone(3,3,3,{x:1,y:1},{x:2,y:2},{isTorus:!0,width:3,height:3})).toBe(!0)})}),describe("distance",function(){return it("returns distance between the points",function(){return expect(u.distance({x:1,y:1},{x:3,y:1},{isTorus:!1})).toBe(2),expect(u.distance({x:1,y:1},{x:4,y:9},{isTorus:!1})).toBeCloseTo(8.54)}),it("returns distance between the closest points on the torus",function(){return expect(u.distance({x:1,y:1},{x:4,y:9},{isTorus:!0,width:20,height:20})).toBeCloseTo(8.54),expect(u.distance({x:1,y:1},{x:4,y:9},{isTorus:!0,width:10,height:10})).toBeCloseTo(3.61)})}),describe("torus4Points",function(){return it("returns the 4 reflected points",function(){return expect(u.torus4Points({x:1,y:1},{x:4,y:9},10,10)).toEqual([{x:4,y:9},{x:-6,y:9},{x:4,y:-1},{x:-6,y:-1}])})}),describe("closestTorusPoint",function(){return it("returns the closest of the 4 reflected points",function(){return expect(u.closestTorusPoint({x:1,y:1},{x:4,y:9},10,10)).toEqual({x:4,y:-1})})}),describe("importImage",function(){return it("returns an image object",function(){var e,t,n;return global.Image=function(){function e(){}return e}(),n="http://www.duck.com/wing.jpg",e=function(e){return 23*e},t=u.importImage(n,e),expect(t.src).toEqual(n),expect(t.isDone).toBe(!1),expect(t.onload.toString()).toContain("isDone")})}),describe("xhrLoadFile",function(){return it("returns an image object",function(){var e,t,n,r;return global.XMLHttpRequest=function(){function e(){}return e.prototype.open=function(){},e.prototype.send=function(){},e}(),n="http://www.duck.com/quack.yml",r="unicorns",e=function(e){return 23*e},t=u.xhrLoadFile(n,null,r,e),expect(t.responseType).toEqual(r),expect(t.isDone).toBe(!1),expect(t.onload.toString()).toContain("isDone")})}),describe("filesLoaded",function(){return it("returns true if all files were loaded",function(){var e,t;return global.Image=function(){function e(){}return e}(),u.fileIndex={},t="http://www.duck.com/beek.jpg",expect(u.filesLoaded()).toBe(!0),e=u.importImage(t),expect(u.filesLoaded()).toBe(!1),u.fileIndex[t].isDone=!0,expect(u.filesLoaded()).toBe(!0)})}),describe("waitOnFiles",function(){return it("waits on files that weren't loaded yet",function(){var e,t;return global.Image=function(){function e(){}return e}(),global.setTimeout=function(e){return u.fileIndex["tail.jpg"].isDone=!0,e()},u.fileIndex={},e=function(){return 2},e=jasmine.createSpy(),t=u.importImage("tail.jpg"),expect(u.filesLoaded()).toBe(!1),u.waitOnFiles(e),expect(u.filesLoaded()).toBe(!0),expect(e).toHaveBeenCalled()})}),describe("cloneImage",function(){return it("creates a new image object with the same source",function(){var e,t,n;return global.Image=function(){function e(){}return e}(),n="pond.jpg",t=new Image,t.src=n,e=u.cloneImage(t),expect(e).not.toBe(t),expect(e.src).toEqual(n)})}),describe("imageToData",function(){return it("creates a new image object with the same source",function(){var e,t,n;return global.Image=function(){function e(){}return e}(),n="pond.jpg",t=new Image,t.src=n,e=u.imageToData(t),expect(e.length).toEqual(0)})}),describe("pixelByte",function(){return it("returns a pixel byte function",function(){return expect(u.pixelByte(1)([1,2,3],1)).toEqual(3)})}),describe("linearInterpolate",function(){return it("returns a linear interpolation",function(){return expect(u.linearInterpolate(1,5,.5)).toEqual(3)})}),describe("typedToJS",function(){return it("returns a JS array",function(){var e;return e=new Uint8Array([1,2]),e=u.typedToJS(e),expect(null!=e.sort).toBe(!0)})})})}).call(this);